# DzrSourceHelper

CLI-утилита, которая подтягивает уровни из шаблона Google Docs, проверяет заполнение и заливает задания и файлы в движок DozoR (`classic.dzzzr.ru`).

## Что умеет
- Загрузка новых уровней или обновление существующих из структурированного Google Docs.
- Быстрая проверка документа на обязательные поля и корректные значения перед заливкой.
- Автоматическая выгрузка файлов (картинки, вложения) из Google Drive в файловый менеджер движка.
- Добавление технического уровня-заглушки после загрузки новых заданий.

## Подготовка окружения
1. Установите зависимости: pip install -r requirements.txt.
2. Создайте файл .env в корне проекта со значениями:
   - LOGIN и PASSWORD — учетные данные админки DozoR.
   - CITY — код города из URL (например `msk`).
   - GAME_ID — ID игры в админке.
   - DOCUMENT_ID — ID Google Docs с уровнями.
   - FOLDER_ID — ID папки Google Drive с файлами для уровней.
3. Положите credentials.json сервисного аккаунта в корень проекта. Сервисный аккаунт должен иметь доступ на чтение к Google Docs и к папке на Google Drive.

## Использование
Запустите: python main.py

Доступные действия в меню:
- [1] Добавить задания с нуля — загрузка новых уровней; при желании сразу подгружает файлы с Google Drive; после завершения добавляет технический уровень.
- [2] Обновить существующие уровни — обновление по ID из документа.
- [3] Закачать файлы из гугл диска в движок — только загрузка файлов без работы с заданиями.
- [4] Выйти из программы.

Ошибки пишутся в log.log. В консоли отображается ход проверки и заливки.

## О формате Google Docs
- Используется структурированный документ с заголовками и таблицами; пример: https://docs.google.com/document/d/1k6fIBklOQGYmwBHukDW25oAmH9tc5jGh71eB8KMm-Gs/edit
- Первые три вкладки в документе пропускаются, последующие вкладки считаются уровнями.
- Сквозные и бонусные настройки, тайминги подсказок, штрафы, коды, спойлеры и бонусы должны быть заполнены согласно шаблону — перед заливкой файл проходит проверку

## Полезно знать
- Файлы из Google Drive попадают в /uploaded/{CITY}/Night/games/{GAME_ID} на сервере.
- Текстовые поля преобразуются в HTML (переводы строк меняются на <br>, кодировка — windows-1251).
- При возникновении проблем с сетью или доступами проверьте валидность .env и права сервисного аккаунта.